"use strict";(self.webpackChunksky_fly=self.webpackChunksky_fly||[]).push([[782],{6782:(H,_,l)=>{l.r(_),l.d(_,{FlightsModule:()=>K});var s=l(6895),b=l(898),a=l(4006),g=l(284),t=l(4650),C=l(4004),T=l(7471);let f=(()=>{class o{constructor(e){this.db=e,this.API_URL="/flights"}getFlights(){return this.db.list(this.API_URL).snapshotChanges().pipe((0,C.U)(e=>e.map(i=>this.assignKey(i))))}getOneFlight(e){return this.db.object(`${this.API_URL}/${e}`).snapshotChanges().pipe((0,C.U)(i=>this.assignKey(i)))}addFlight(e){return this.db.list(this.API_URL).push(e)}editFlight(e,i){return this.db.object(`${this.API_URL}/${e}`).update(i)}removeFlight(e){return this.db.object(`${this.API_URL}/${e}`).remove()}assignKey(e){return{...e.payload.val(),key:e.key}}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(T.KQ))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var v=l(7009),c=l(5412),d=l(4859);const A=o=>o.value.startsWith("SKY")?null:{incorrectCode:!0};var u=l(3336),p=l(9549),y=l(4144),w=l(6709),U=l(5113),M=l(3238);function x(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Field is required"),t.qZA())}function q(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Min length is 4"),t.qZA())}function k(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Max length is 10"),t.qZA())}function N(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,'Code must starts with "SKY" prefix'),t.qZA())}function I(o,n){if(1&o&&(t.TgZ(0,"mat-option",26),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.label)}}function O(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",16)(1,"div",17)(2,"div",12)(3,"span"),t._uU(4),t.qZA()()(),t.TgZ(5,"div",18)(6,"div",19)(7,"mat-form-field",20)(8,"mat-label"),t._uU(9,"Name"),t.qZA(),t._UZ(10,"input",21),t.qZA()(),t.TgZ(11,"div",19)(12,"mat-form-field",20)(13,"mat-label"),t._uU(14,"Profession"),t.qZA(),t.TgZ(15,"mat-select",22),t.YNc(16,I,2,2,"mat-option",23),t.qZA()()(),t.TgZ(17,"div",24)(18,"mat-icon",25),t.NdJ("click",function(){const m=t.CHM(e).index,F=t.oxw();return t.KtG(F.removeCrewMember(m))}),t._uU(19,"delete_forever"),t.qZA()()()()}if(2&o){const e=n.index,i=t.oxw();t.xp6(4),t.hij("Crew Member - ",e+1,""),t.xp6(1),t.Q6J("formGroupName",e),t.xp6(11),t.Q6J("ngForOf",i.professions)}}let Z=(()=>{class o{constructor(e){this.fb=e,this.editMode=!1,this.professions=[{label:"Flight attendant",value:"flight_attendant"},{label:"Senior Cabin Crew",value:"senior_cabin_crew"},{label:"Pilot",value:"Pilot"},{label:"Co-Pilot",value:"co_pilot"},{label:"Mechanic",value:"mechanic"}]}ngOnInit(){this.buildForm()}setFlight(e){const{key:i,...r}=e;this.flightForm.patchValue(r),void 0!==r.crew&&r.crew.forEach(m=>this.addCrewMember(m))}buildForm(){this.flightForm=this.fb.group({additionalInformation:"",code:["SKY",{validators:[a.kI.required,a.kI.minLength(4),a.kI.maxLength(10),A]}],departureTime:["",{validators:[a.kI.required]}],destination:["",{validators:[a.kI.required]}],origin:["",{validators:[a.kI.required]}],returnTime:["",{validators:[a.kI.required]}],withSKPlanesDiscount:!1,crew:this.fb.array(this.editMode?[]:[this.buildCrewMember()])})}buildCrewMember(e={}){return this.fb.group({name:e.name||"",job:e.job||""})}get crew(){return this.flightForm.get("crew")}get code(){return this.flightForm.get("code")}removeCrewMember(e){this.crew.removeAt(e)}addCrewMember(e){this.crew.push(this.buildCrewMember(e))}trackByFn(e){return e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(a.qu))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-flight-form"]],inputs:{editMode:"editMode"},decls:49,vars:12,consts:[[3,"formGroup"],[1,"row"],["appearance","fill",1,"col-sm-8"],["formControlName","code","matInput",""],[4,"ngIf"],["align","end"],["appearance","fill",1,"col-sm-4"],["formControlName","origin","matInput",""],["formControlName","destination","matInput",""],["formControlName","departureTime","matInput",""],["formControlName","returnTime","matInput",""],["formControlName","additionalInformation","matInput",""],[1,"col"],["formControlName","withSKPlanesDiscount"],["formArrayName","crew","class","container-crew",4,"ngFor","ngForOf","ngForTrackBy"],["mat-raised-button","","color","primary",3,"click"],["formArrayName","crew",1,"container-crew"],[1,"row","crew-header"],[1,"row","crew-content",3,"formGroupName"],[1,"col-sm-5"],["appearance","standard",1,"col-sm-8"],["formControlName","name","matInput",""],["formControlName","job"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-2"],[1,"float-end",3,"click"],[3,"value"]],template:function(e,i){1&e&&(t.TgZ(0,"form",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label"),t._uU(4,"Code"),t.qZA(),t._UZ(5,"input",3),t.YNc(6,x,2,0,"mat-error",4),t.YNc(7,q,2,0,"mat-error",4),t.YNc(8,k,2,0,"mat-error",4),t.YNc(9,N,2,0,"mat-error",4),t.TgZ(10,"mat-hint",5),t._uU(11),t.qZA()()(),t.TgZ(12,"div",1)(13,"mat-form-field",6)(14,"mat-label"),t._uU(15,"Origin"),t.qZA(),t._UZ(16,"input",7),t.qZA(),t.TgZ(17,"mat-form-field",6)(18,"mat-label"),t._uU(19,"Destination"),t.qZA(),t._UZ(20,"input",8),t.qZA()(),t.TgZ(21,"div",1)(22,"mat-form-field",6)(23,"mat-label"),t._uU(24,"Departure Time"),t.qZA(),t._UZ(25,"input",9),t.qZA(),t.TgZ(26,"mat-form-field",6)(27,"mat-label"),t._uU(28,"Return Time"),t.qZA(),t._UZ(29,"input",10),t.qZA()(),t.TgZ(30,"div",1)(31,"mat-form-field",2)(32,"mat-label"),t._uU(33,"Additional Information"),t.qZA(),t._UZ(34,"textarea",11),t.qZA()(),t.TgZ(35,"div",1)(36,"div",12)(37,"mat-checkbox",13),t._uU(38,"With Sky-Fly Discount"),t.qZA()()(),t.YNc(39,O,20,3,"div",14),t.TgZ(40,"div",1)(41,"div",12)(42,"button",15),t.NdJ("click",function(){return i.addCrewMember()}),t._uU(43,"Add crew member"),t.qZA()()()(),t.TgZ(44,"pre"),t._uU(45),t.ALo(46,"json"),t.qZA(),t.TgZ(47,"pre"),t._uU(48),t.qZA()),2&e&&(t.Q6J("formGroup",i.flightForm),t.xp6(6),t.Q6J("ngIf",null==i.code?null:i.code.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==i.code?null:i.code.hasError("minlength")),t.xp6(1),t.Q6J("ngIf",null==i.code?null:i.code.hasError("maxlength")),t.xp6(1),t.Q6J("ngIf",null==i.code?null:i.code.hasError("incorrectCode")),t.xp6(2),t.hij("",null==i.code?null:i.code.value.length," / 10"),t.xp6(28),t.Q6J("ngForOf",i.crew.controls)("ngForTrackBy",i.trackByFn),t.xp6(6),t.Oqu(t.lcZ(46,10,i.flightForm.value)),t.xp6(3),t.hij("isFormValid: ",i.flightForm.valid,""))},dependencies:[s.sg,s.O5,u.Hw,p.TO,p.KE,p.bx,p.hX,y.Nt,d.lW,w.oG,U.gD,M.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,a.x0,a.CE,s.Ts],styles:[".container-crew[_ngcontent-%COMP%]{box-shadow:1px 1px 6px #ddd;margin:10px 0;padding:10px}.container-crew[_ngcontent-%COMP%]   .crew-header[_ngcontent-%COMP%]{font-weight:700}.container-crew[_ngcontent-%COMP%]   .crew-content[_ngcontent-%COMP%]{align-items:center}.container-crew[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),o})();const E=["form"];let J=(()=>{class o{constructor(e,i,r){this.flightsService=e,this.toast=i,this.dialogRef=r}ngOnInit(){}createFlight(){console.log(this.form.flightForm),this.flightsService.addFlight(this.form.flightForm.value).then(this.onCreatingSuccess.bind(this),this.onCreatingFailure.bind(this))}onCreatingSuccess(){this.dialogRef.close(),this.toast.open("Flight has been successfully created!","",{panelClass:"toast-success"})}onCreatingFailure(e){this.toast.open(e.message,"",{panelClass:"toast-error"})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(f),t.Y36(v.ux),t.Y36(c.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-new-flight-modal"]],viewQuery:function(e,i){if(1&e&&t.Gf(E,5),2&e){let r;t.iGM(r=t.CRH())&&(i.form=r.first)}},decls:10,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],["form",""],["align","end"],["mat-raised-button","","mat-dialog-close",""],["mat-raised-button","","color","primary","cdkFocusInitial","",3,"disabled","mat-dialog-close","click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Create new Flight"),t.qZA(),t.TgZ(2,"mat-dialog-content",1),t._UZ(3,"app-flight-form",null,2),t.qZA(),t.TgZ(5,"mat-dialog-actions",3)(6,"button",4),t._uU(7,"Cancel"),t.qZA(),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.createFlight()}),t._uU(9,"Create"),t.qZA()()),2&e){const r=t.MAs(4);t.xp6(8),t.Q6J("disabled",r.flightForm.invalid)("mat-dialog-close",!0)}},dependencies:[c.ZT,c.uh,c.xY,c.H8,d.lW,Z]}),o})();function S(o,n){if(1&o&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}let Y=(()=>{class o{constructor(e,i,r){this.dialogRef=e,this.data=i,this.router=r,this.flight=i}close(){this.dialogRef.close()}goToEditDetails(){this.close(),this.router.navigate(["dashboard/flights",this.flight.key])}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.so),t.Y36(c.WI),t.Y36(g.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-details"]],decls:14,vars:2,consts:[[1,"row"],[1,"col"],[1,"float-end",3,"click"],[1,"label"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"float-end",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3," FLIGHT DETAILS "),t.TgZ(4,"mat-icon",2),t.NdJ("click",function(){return i.close()}),t._uU(5,"close"),t.qZA()(),t.TgZ(6,"p",3),t._uU(7),t.qZA(),t.TgZ(8,"p",3),t._uU(9,"Crew:"),t.qZA(),t.TgZ(10,"ul"),t.YNc(11,S,2,1,"li",4),t.qZA(),t.TgZ(12,"button",5),t.NdJ("click",function(){return i.goToEditDetails()}),t._uU(13," EDIT FLIGHT "),t.qZA()()()),2&e&&(t.xp6(7),t.hij("Code: ",i.flight.code,""),t.xp6(4),t.Q6J("ngForOf",i.flight.crew))},dependencies:[s.sg,u.Hw,d.lW]}),o})();var h=l(3546);let P=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-flight-card"]],inputs:{flight:"flight"},decls:14,vars:4,consts:[[1,"card-container","mx-1","my-4"],["mat-fab","","color","primary","aria-label","Example icon button with a delete icon",1,"icon"],[1,"text-center"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0)(1,"button",1)(2,"mat-icon"),t._uU(3,"airplanemode_active"),t.qZA()(),t._UZ(4,"br"),t.TgZ(5,"mat-card-header")(6,"mat-card-title"),t._uU(7),t.qZA(),t.TgZ(8,"mat-card-subtitle"),t._uU(9),t.qZA()(),t.TgZ(10,"mat-card-content",2)(11,"p")(12,"span"),t._uU(13),t.qZA()()()()),2&e&&(t.xp6(7),t.Oqu(i.flight.destination),t.xp6(2),t.hij("From: ",i.flight.origin,""),t.xp6(4),t.AsE("",i.flight.departureTime," - ",i.flight.returnTime,""))},dependencies:[u.Hw,h.a8,h.dk,h.dn,h.n5,h.$j,d.lW],styles:["[_nghost-%COMP%]{cursor:pointer}.card-container[_ngcontent-%COMP%]{position:relative;transition:.3s}.card-container[_ngcontent-%COMP%]:hover{box-shadow:2px 2px 10px #3f51b5}.card-container[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;top:-28px;left:50%;transform:translate(-50%)}"],changeDetection:0}),o})();function D(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",4)(1,"app-flight-card",5),t.NdJ("click",function(){const m=t.CHM(e).$implicit,F=t.oxw();return t.KtG(F.openFlightDetailsModal(m))}),t.qZA()()}if(2&o){const e=n.$implicit;t.xp6(1),t.Q6J("flight",e)}}let Q=(()=>{class o{constructor(e,i){this.flightsService=e,this.dialog=i,this.flights$=this.flightsService.getFlights()}openNewFlightModal(){this.dialog.open(J)}openFlightDetailsModal(e){this.dialog.open(Y,{data:e})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(f),t.Y36(c.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-flights"]],decls:6,vars:3,consts:[[1,"row","flights-container","my-4"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"row"],["mat-fab","","color","accent",1,"add-flight-btn",3,"click"],[1,"col-md-4"],[3,"flight","click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.YNc(1,D,2,1,"div",1),t.ALo(2,"async"),t.qZA(),t.TgZ(3,"div",2)(4,"button",3),t.NdJ("click",function(){return i.openNewFlightModal()}),t._uU(5,"+"),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("ngForOf",t.lcZ(2,1,i.flights$)))},dependencies:[s.sg,d.lW,P,s.Ov],styles:[".add-flight-btn[_ngcontent-%COMP%]{position:fixed;bottom:10%;right:5%;font-size:23px}"]}),o})();var j=l(8505);const R=["flightForm"];function L(o,n){if(1&o&&(t.TgZ(0,"span")(1,"b"),t._uU(2),t.qZA(),t._uU(3," details"),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(e.flight.code)}}const G=[{path:"",component:Q},{path:":key",component:(()=>{class o{constructor(e,i,r,m){this.flightsService=e,this.route=i,this.router=r,this.toast=m}ngAfterViewInit(){this.loadFlight()}loadFlight(){this.flightsService.getOneFlight(this.route.snapshot.params.key).pipe((0,j.b)(i=>this.flightForm.setFlight(i))).subscribe(i=>this.flight=i)}saveEditedFlight(){this.flightsService.editFlight(this.flight.key,this.flightForm.flightForm.value).then(this.onSuccess.bind(this,"Flight has been successfully edited!"),this.onFailure.bind(this))}removeFlight(){this.flightsService.removeFlight(this.flight.key).then(this.onSuccess.bind(this,"Flight has been removed!"),this.onFailure.bind(this))}onSuccess(e){this.router.navigate(["/dashboard"]),this.toast.open(e,"",{panelClass:"toast-success"})}onFailure(e){this.toast.open(e.message,"",{panelClass:"toast-error"})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(f),t.Y36(g.gz),t.Y36(g.F0),t.Y36(v.ux))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-edit-flight"]],viewQuery:function(e,i){if(1&e&&t.Gf(R,5),2&e){let r;t.iGM(r=t.CRH())&&(i.flightForm=r.first)}},decls:17,vars:2,consts:[[1,"row"],[1,"col-9"],[4,"ngIf"],[1,"col-3"],["mat-raised-button","","color","warn",3,"click"],[3,"editMode"],["flightForm",""],[1,"col","text-right"],["mat-raised-button",""],["mat-raised-button","","color","primary",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3,"Edit flight "),t.YNc(4,L,4,1,"span",2),t.qZA()(),t.TgZ(5,"div",3)(6,"button",4),t.NdJ("click",function(){return i.removeFlight()}),t.TgZ(7,"mat-icon"),t._uU(8,"delete_forever"),t.qZA()()()(),t._UZ(9,"app-flight-form",5,6),t.TgZ(11,"div",0)(12,"div",7)(13,"button",8),t._uU(14,"RESET"),t.qZA(),t.TgZ(15,"button",9),t.NdJ("click",function(){return i.saveEditedFlight()}),t._uU(16,"SAVE"),t.qZA()()()),2&e&&(t.xp6(4),t.Q6J("ngIf",i.flight),t.xp6(5),t.Q6J("editMode",!0))},dependencies:[s.O5,u.Hw,d.lW,Z]}),o})()}];let $=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.Bz.forChild(G),g.Bz]}),o})(),K=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[s.ez,b.q,a.u5,a.UX,$]}),o})()}}]);